{"version":3,"file":"./chunks/5.chunk.js","sources":["webpack:///./src/components/taskings/Tasking.jsx"],"sourcesContent":["import { Button, Card, Col, Row, Tabs } from 'antd';\nimport React, { Component } from 'react';\nimport Loadable from 'react-loadable';\nimport pdfBuilder, { mdc } from '../../pdf/pdfBuilder';\nimport PageForm from './PageForm';\nimport PageList from './PageList';\n\n// Antd Destructuring\nconst { TabPane } = Tabs;\n\n// LazyLoading\n// const LoadingComponent = <div>Loading...</div>;\n// const pdfBuilder = Loadable({\n//   loader: () => import('../../pdf/pdfBuilder'),\n//   loading: () => LoadingComponent,\n// });\n\n// const mdc = Loadable({\n//   loader: () => import('../../pdf/pdfBuilder').mdc,\n//   loading: () => LoadingComponent,\n// });\n\n/** MDC BUILDER */\nexport default class Tasking extends Component {\n  state = {\n    missionData: null,\n    pages: [],\n  };\n\n  newTabIndex = 0;\n\n  componentDidMount() {\n    // Load the default mission values as a starting point\n    const { defaultData } = mdc;\n\n    // Initialize the default set of panes\n    // They need the \"isDefault: true\" property, and will have their content added at render()\n    const panes = [\n      {\n        title: 'Configure MDC',\n        key: 'mdc-setup',\n        closable: false,\n        isDefault: true,\n        content: null,\n      },\n      {\n        title: 'Navigation',\n        key: 'mdc-nav',\n        closable: false,\n        isDefault: true,\n        content: null,\n      },\n      {\n        title: 'Signals',\n        key: 'mdc-signals',\n        closable: false,\n        isDefault: true,\n        content: null,\n      },\n    ];\n\n    // Update state\n    this.setState({ missionData: defaultData, activeKey: panes[0].key, panes });\n  }\n\n  // componentDidUpdate(prevProps, prevState) {\n  //   const { missionData } = this.state;\n  //   if (missionData !== prevState.missionData) {\n  //     console.log('Tasking: I should update my children now!');\n  //     // this.setState({ missionData });\n  //   }\n  // }\n\n  generatePDF = () => {\n    const { missionData, pages } = this.state;\n\n    /** Generate pages */\n    const content = [];\n    pages.forEach((page) => {\n      if (page.createPage) {\n        content.push(page.createPage(missionData));\n      }\n      return null;\n    });\n\n    /**  Generate and then open the pdf */\n    const pdf = pdfBuilder.makePdf(`132ND-MDC-${missionData.missionNumber}`, content);\n    pdf.open();\n  };\n\n  onTabChange = (activeKey) => {\n    this.setState({ activeKey });\n  };\n\n  onTabEdit = (targetKey, action) => {\n    switch (action) {\n      case 'add':\n        this.addTab();\n        break;\n      case 'remove':\n        this.removeTab(targetKey);\n        break;\n      default:\n        break;\n    }\n  };\n\n  updatePages = (pages) => {\n    const { panes } = this.state;\n\n    // Create new panes for all PDF pages (i.e. they have a createPage function)\n    const formPanes = pages.map((page) => {\n      const props = mdc.pages[page.pageKey];\n      if (page.createPage) {\n        return {\n          title: page.label,\n          key: `mdc-tab-${page.key}`,\n          create: page.createPage,\n          form: props.form,\n          content: null,\n        };\n      }\n    });\n\n    // Keep all default panes (i.e. they have isDefault:true set)\n    const defaultPanes = panes.filter((pane) => pane.isDefault === true);\n\n    // Update state with the new pages, activeKey and panes\n    this.setState(() => ({\n      pages,\n      panes: [...defaultPanes, ...formPanes],\n    }));\n  };\n\n  updateData = (dataObject) => {\n    this.setState((prevState) => ({\n      missionData: Object.assign({}, prevState.missionData, dataObject),\n    }));\n  };\n\n  render() {\n    const { missionData, activeKey, panes, list } = this.state;\n    if (!missionData) return <div>Loading...</div>;\n\n    // Generate the content array from available MDC pages\n    const templates = Object.keys(mdc.pages).map((page) => {\n      const pageObj = mdc.pages[page];\n      return {\n        title: pageObj.title,\n        key: page,\n        createPage: pageObj.create,\n      };\n    });\n\n    // Add default content (PageForm) for all panes that have a form property\n    panes.forEach((pane) => {\n      /* eslint no-param-reassign:0 */\n      if (pane.form) {\n        pane.content = (\n          <PageForm form={pane.form} onUpdate={this.updateData} missionData={missionData} />\n        );\n      }\n    });\n\n    // Add default content to MDC-Setup tab (overrides the above function)\n    panes[0].content = (\n      <React.Fragment>\n        <p>Some instructions here, followed by the add/remove/rearrange pages</p>\n        <PageList list={list} content={templates} onUpdate={this.updatePages} />\n      </React.Fragment>\n    );\n\n    const tabPanes = panes.map((pane) => (\n      <TabPane tab={pane.title} key={pane.key} closable={false}>\n        {pane.content}\n      </TabPane>\n    ));\n\n    const tabActions = (\n      <React.Fragment>\n        <Button type='primary' onClick={this.generatePDF} style={{ marginLeft: '0.5em' }}>\n          Print MDC\n        </Button>\n      </React.Fragment>\n    );\n\n    return (\n      <Card title='MDC Builder'>\n        <Row>\n          <Col className='gutter-row' span={24} md={24}>\n            <Tabs\n              hideAdd\n              type='editable-card'\n              onChange={this.onTabChange}\n              activeKey={activeKey}\n              onEdit={this.onTabEdit}\n              tabBarExtraContent={tabActions}>\n              {tabPanes}\n            </Tabs>\n          </Col>\n        </Row>\n      </Card>\n    );\n  }\n}\n"],"mappings":"AACA","sourceRoot":""}